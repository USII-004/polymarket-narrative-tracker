// prisma/schema.prisma
// Updated schema for Top 20 by DAILY volume

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Current top 20 markets by daily volume
model Market {
  id                String   @id
  title             String
  category          String?
  description       String?
  yesPrice          Float    // Current YES price (0-1)
  noPrice           Float    // Current NO price (0-1)
  volume24h         Float    // 24-hour volume
  totalVolume       Float    // Total lifetime volume
  volumeChange      Float?   @default(0) // % change in 24h volume
  priceChange24h    Float?   @default(0) // % change in YES price
  lastUpdated       DateTime @default(now())
  isCurrentTop20    Boolean  @default(true)
  image             String?
  endDate           DateTime?
  createdAt         DateTime @default(now())
  
  // Relations
  snapshots         MarketSnapshot[]
  
  @@index([volume24h(sort: Desc)])
  @@index([lastUpdated])
  @@index([isCurrentTop20])
}

// Historical snapshots - captured every 4 hours
model MarketSnapshot {
  id              String   @id @default(cuid())
  marketId        String
  title           String
  yesPrice        Float
  noPrice         Float
  volume24h       Float
  totalVolume     Float
  rank            Int      // Position in top 20 (1-20)
  capturedAt      DateTime @default(now())
  
  market          Market   @relation(fields: [marketId], references: [id], onDelete: Cascade)
  
  @@index([marketId])
  @@index([capturedAt])
  @@index([rank])
}

// Track when markets enter/exit top 20
model TrendingEvent {
  id          String   @id @default(cuid())
  marketId    String
  marketTitle String
  eventType   String   // "ENTERED" | "EXITED" | "RANK_UP" | "RANK_DOWN"
  oldRank     Int?
  newRank     Int?
  volume24h   Float
  createdAt   DateTime @default(now())
  
  @@index([createdAt])
  @@index([eventType])
}

// System configuration
model SystemConfig {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String
  updatedAt   DateTime @updatedAt
}